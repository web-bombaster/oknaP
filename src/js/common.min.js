
document.addEventListener(
	"DOMContentLoaded", () => {
		function loadData() {
	return new Promise((resolve, reject) => {
	  	// setTimeout не является частью решения
	  	// Код ниже должен быть заменен на логику подходящую для решения вашей задачи
		setTimeout(resolve, 100);
	})
};

loadData()
	.then(() => {
		let preloaderEl = document.getElementById('preloader');
		preloaderEl.classList.add('hidden');
		preloaderEl.classList.remove('visible');
	});// функция будет перемещать блок в указанное место при определенной ширине экрана

let moving = function () {

    const windowWidth = window.innerWidth; // ширина экрана
    // console.log(windowWidth);

    // перемещение меню
    if (windowWidth <= 1024) {
        document.querySelector('.mobile-menu__box').prepend(document.querySelector('.nav-menu'));
    } else {
        document.querySelector('.nav .container').append(document.querySelector('.nav-menu'));
    };

        // перемещение меню
        if (windowWidth <= 660) {
            document.querySelector('.footer__bottom').prepend(document.querySelector('.not-offer'));
        } else {
            document.querySelector('.footer__col.text').append(document.querySelector('.not-offer'));
        };




};

moving();
window.addEventListener('resize', moving);const headerFixed = () => {
    if (document.documentElement.clientWidth <= 1024) {
        const heightHeader = document.querySelector('.header').offsetHeight; // высота хедера
        document.body.style.paddingTop = heightHeader + 'px';
    } else {
        document.body.style.paddingTop = 0;
    };
};

headerFixed();
// запускаем headerFixed при ресайзе
window.addEventListener("resize", headerFixed);// Показать / скрыть мобильное меню
function mobileMenu() {
	if (document.querySelector(".jsMobileMenuBtnToggle")) {
		const menuBtn = document.querySelector(".jsMobileMenuBtnToggle");
		const body = document.querySelector("body");
		const menu = document.querySelector(".mobile-menu");

		function mobileMenuOpen() {
			menu.classList.add("toggle");
			body.classList.add("toggle");
			menuBtn.classList.add("toggle");
		}

		function mobileMenuClose() {
			menu.classList.remove("toggle");
			body.classList.remove("toggle");
			menuBtn.classList.remove("toggle");
		}

		// Показать / скрыть мобильное меню
		function menuToggle() {
			if (!menuBtn.classList.contains("toggle")) {
				mobileMenuOpen();
			} else {
				mobileMenuClose();
			}
		}

		menuBtn.addEventListener("click", menuToggle);

		window.addEventListener(
			"resize",
			function () {
				mobileMenuClose();
			},
			true
		);

		// Закрываем мобильное меню по клику вне его
		function closeMobileMenu() {
			document.addEventListener("click", function (e) {
				const target = e.target;
				const its_menu = target == menu || menu.contains(target);
				const its_btnMenu = target == menuBtn || menuBtn.contains(target);
				
				if (!its_menu && !its_btnMenu) {
					mobileMenuClose();
				}
			});
		}

		closeMobileMenu();
	}
}

mobileMenu();
// Вычисление позиции и размера панели мобильного меню

if (document.querySelector(".jsMobileMenuBtnToggle")) {
	let menuPanelInit = function () {

		const menuBtn = document.querySelector(".jsMobileMenuBtnToggle");
		
		// Определяем высоту мобильного меню и размещаем под шапкой
		function menuPanelPosition() {
			const heightViewport = document.documentElement.clientHeight;
			const heightHeader = document.querySelector(".header").offsetHeight;
			const heightMenuOverlay = heightViewport - heightHeader;

			const menuActive = document.querySelector(".mobile-menu.toggle");

			if (menuActive) {
				menuActive.style.height = heightViewport + "px";
				menuActive.style.paddingTop = heightHeader + "px";
			}

		}

		menuBtn.addEventListener("click", menuPanelPosition);
	};

	menuPanelInit();
}



// Показать / скрыть в мобильном меню подменю
function subMenuToggle(element) {
	const subMenuBtn = document.querySelectorAll('.mobile-menu .nav-menu__link--open-panel'); // ссылка для открытия подменю
	const navListMobile = document.querySelector('.mobile-menu__wrapper'); // сюда будем складывать обертки подменюшек
	let zIndexValue = 100;

	let heightHeader = document.querySelector(".header").offsetHeight;



	// По клику на кнопку для субменю будем формировать и показывать подменю
	const subBtnClick = (e) => {

		e.preventDefault();

		// Формируем обертку для подменю
		const subMenuWrapper = document.createElement('div');
		zIndexValue++;
		subMenuWrapper.classList.add('submenu-wrapper'); // обертка для подменю
		subMenuWrapper.classList.add('z-index'); // обертка для подменю
		subMenuWrapper.classList.add('z-index-' + zIndexValue); // для каждого уровня подменю счетчик у класса будет увеличиваться
		// subMenuWrapper.classList.remove('nav__list');
		navListMobile.append(subMenuWrapper); // добавляем обртку к основному меню

		subMenuWrapper.style.zIndex = zIndexValue;
		subMenuWrapper.style.paddingTop = heightHeader + 35 + 'px';
		
		console.log("heightHeader - " + heightHeader);
		console.log("zIndexValue - " + zIndexValue);

		// Формируем хедер для подменю с кнопкой назад
		const subMenuHeader = document.createElement('div');
		subMenuHeader.classList.add('submenu__header'); // обертка для кноки назад
		const textForPrevLink = e.srcElement.textContent; // текст для кноки назад
		subMenuHeader.textContent = textForPrevLink;
		subMenuWrapper.append(subMenuHeader);

		// Формируем подменю
		// const newSubMenu = e.target.parentNode.cloneNode(true);
		let newSubMenu = e.target.parentNode.querySelector('.nav-menu__submenu').cloneNode(true);
		subMenuWrapper.append(newSubMenu);

		// const heightSubMenu = subMenuWrapper.offsetHeight;
		// console.log("heightSubMenu - " + heightSubMenu);



		// Закрываем подменю для возврата к родителю
		subMenuHeader.addEventListener("click", () => {
			setTimeout(() => { subMenuWrapper.classList.toggle('active'); }, 100); // класс, чтобы выдвигать меню
			setTimeout(() => { subMenuWrapper.remove(); }, 500); // удаляем подменю, чтобы не пложить копии
			zIndexValue--;
		});

		// subMenuWrapper.style.top = 60 + 'px'; // добавляем отступ
		// класс, чтобы выдвигать меню
		setTimeout(() => { subMenuWrapper.classList.add('active'); }, 100); // класс, чтобы выдвигать меню
	};

	// Для каждой кноппки, открывающей панель подменю, отслеживаем клик - для показа подменю второго уровня
	subMenuBtn.forEach(element => {
		element.addEventListener("click", subBtnClick);
	});

}

subMenuToggle();
window.addEventListener("resize", subMenuToggle);// -include './myscripts/burger.js'
		// -include './myscripts/form.js'
		// -include './myscripts/accordeon.js'
		// Показать / скрыть скрытый текст отзыва
if (document.querySelector(".cr-item__text-more")) {
	const textMore = document.getElementsByClassName('cr-item__text-more');
    for (let element of textMore) {
        // console.log(element);

        element.addEventListener("click", () => {
			element.parentNode.firstElementChild.classList.toggle("active");
			if (element.textContent == "Скрыть") {
				element.textContent = "Читать далее";
			} else {
				element.textContent = "Скрыть";
			};
		});
    };
};
// Инициализация слайдера swiper
// https://swiperjs.com/

// Кнопки-табы для блока "Окна Rehau по цене производителя"
function initSwiper() {
	if (document.querySelector(".why-popular__slider")) {
		const whyPopularSlider = new Swiper(".why-popular__slider", {
			spaceBetween: 20,
			slidesPerView: 1,
			loop: true,

			pagination: {
				el: ".why-popular__pagination",
				clickable: true,
			},

			navigation: {
				nextEl: ".why-popular__next",
				prevEl: ".why-popular__prev",
			},
		});
	};

	if (document.querySelector(".our-works__slider")) {
		const prodSliderInner = new Swiper(".our-works__slider", {
			spaceBetween: 20,
			slidesPerView: 1,
			loop: true,

			pagination: {
				el: ".our-works__pagination",
				clickable: true,
			},

			navigation: {
				nextEl: ".our-works__next",
				prevEl: ".our-works__prev",
			},
		});
	};

	if (document.querySelector(".pr-slider")) {
		let menu = ["Blitz", "Grazio", "Delight", "Intelio"];

		const prodSliderInner = new Swiper(".pr-slider", {
			spaceBetween: 20,
			slidesPerView: 1,
			pagination: {
				el: ".pr-btns",
				clickable: true,
				bulletClass: "pr-btns__item",
				renderBullet: function (index, className) {
					return (
						'<span class="' +
						className +
						'">' +
						menu[index] +
						"</span>"
					);
				},
			},
		});
	};

	// Окна Rehau по цене производителя - вложенный слайдер
	if (document.querySelector(".slider-windows")) {
		const prodSliderInner = new Swiper(".slider-windows", {
			spaceBetween: 20,
			slidesPerView: 1,
			loop: true,
			disableOnInteraction: false,
			pauseOnMouseEnter: true,
			breakpoints: {
				500: {
					slidesPerView: 2,
					spaceBetween: 10,
					loop: true,
				},
				768: {
					slidesPerView: 3,
					spaceBetween: 20,
					loop: true,
				},
				1001: {
					slidesPerView: 4,
					spaceBetween: 20,
					loop: true,
				},
			},
			pagination: {
				el: ".slider-windows__pagination",
				clickable: true,
			},
			navigation: {
				nextEl: ".slider-windows__next",
				prevEl: ".slider-windows__prev",
			},
		});
	};

	// Профильные системы Rehau
	if (document.querySelector(".systems-rehau__slider")) {
		const prodSliderInner = new Swiper(".systems-rehau__slider", {
			spaceBetween: 20,
			slidesPerView: 1,
			loop: true,
			disableOnInteraction: false,
			pauseOnMouseEnter: true,
			breakpoints: {
				500: {
					slidesPerView: 2,
					spaceBetween: 10,
					loop: true,
				},
				768: {
					slidesPerView: 3,
					spaceBetween: 20,
					loop: true,
				},
				1001: {
					slidesPerView: 4,
					spaceBetween: 20,
					loop: true,
				},
			},
			navigation: {
				nextEl: ".systems-rehau__next",
				prevEl: ".systems-rehau__prev",
			},
			pagination: {
				el: ".systems-rehau__pagination",
				clickable: true,
			},
		});
	}

	// Окна Rehau по цене производителя - вложенный слайдер
	if (document.querySelector(".customer-reviews__slider")) {
		const customerReviewsSlider = new Swiper(".customer-reviews__slider", {
			spaceBetween: 10,
			slidesPerView: 1,
			loop: true,
			// disableOnInteraction: false,
			// pauseOnMouseEnter: true,
			breakpoints: {
				768: {
					slidesPerView: 2,
					spaceBetween: 20,
					loop: true,
				},
			},
			pagination: {
				el: ".customer-reviews__pagination",
				clickable: true,
			},
			navigation: {
				nextEl: ".customer-reviews__next",
				prevEl: ".customer-reviews__prev",
			},
		});
	}

	// Наши сертификаты и гарантии
	if (document.querySelector(".certificates-slider")) {
		const certificatesSliderSlider = new Swiper(".certificates-slider", {
			spaceBetween: 12,
			slidesPerView: 2,
			loop: true,
			// disableOnInteraction: false,
			// pauseOnMouseEnter: true,
			breakpoints: {
				500: {
					slidesPerView: 3,
					spaceBetween: 20,
					loop: true,
				},
				660: {
					slidesPerView: 4,
					spaceBetween: 20,
					loop: true,
				},
				920: {
					slidesPerView: 5,
					spaceBetween: 20,
					loop: true,
				},
			},
			pagination: {
				el: ".certificates-slider__pagination",
				clickable: true,
				dynamicBullets: true,
			},
			navigation: {
				nextEl: ".certificates-slider__next",
				prevEl: ".certificates-slider__prev",
			},
		});
	}
}

// window.addEventListener("resize", initSwiper);
window.addEventListener("resize", function () {
	// setTimeout(initSwiper, 200);
	initSwiper();
	// swiper.init();
});

initSwiper();
// Табы. Параметры: класс для кнопок табов и класс содержимого табов
const tabsToggle = function (tabBtnClass, tabContentClass) {
	if (document.querySelector(tabBtnClass)) {
		const tabsBtn = document.querySelectorAll(tabBtnClass); // все кнопки табов
		const tabsContent = document.querySelectorAll(tabContentClass); // все содержимое табов

		// Перебираем кнопки табов, по которым можем щелкнуть
		tabsBtn.forEach(function (btn, index) {
			// Вешаем событие клика на каждую кнопку
			btn.addEventListener("click", function () {
                if (btn.classList.contains("toggle")) {
                    tabsBtn[index].classList.remove("toggle");
                    tabsContent[index].classList.remove("toggle");

				} else {
                    // у кнопки, по которой щелкнули, добавить класс активности
					tabsBtn[index].classList.add("toggle");
                    // у содержимого с этим индексом добавить класс активности
                    tabsContent[index].classList.add("toggle");
				}

			});
		});
	}
};

// tabsToggle(".footer-top__title", ".footer-menu");
tabsToggle(".footer-top__title", ".footer-top__col");
tabsToggle(".faq-item__title", ".questions-faq__item");
// функция будет перемещать блок в указанное место при определенной ширине экрана

let compareProfile = function () {
	if (document.querySelector(".compare-profile__grid")) {
		let table = document.querySelector(".compare-profile__grid"); // таблица для сдвига
		const windowWidth = window.innerWidth; // ширина экрана
		let indent; // отступ при пролистывании
		let ratio = 0; // коэффициент сдвига
		let next = document.querySelector(".compare-profile__next");
		let prev = document.querySelector(".compare-profile__prev");

        let test;

		switch (true) {
			case windowWidth <= 480 && windowWidth >= 341:
				indent = 50;
                ratio = 2;
				break;
			case windowWidth <= 340:
				indent = 100;
                ratio = 3;
				break;
			default:
				indent = 33.33333;
                ratio = 1;
				break;
		}

		next.addEventListener("click", function () {
			if (ratio >= 1) {
                test = -1 * indent * ratio;
                test = "translateX(" + test + "%)";
                table.style.transform = test;
				ratio--;
                console.log("ratio - " + ratio);
			}
		});

		prev.addEventListener("click", function () {
			if (ratio > 1) {
                table.classList.add("prev")

                test = indent * ratio;
                test = "translateX(" + test + "%)";

                table.style.transform = test;
				ratio--;
			}
		});
	}
};

compareProfile();
window.addEventListener("resize", compareProfile);
// -include './myscripts/blazy-init.js'
	}
);